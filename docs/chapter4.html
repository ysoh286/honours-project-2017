<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title></title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Report</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="abstract.html">Abstract</a>
</li>
<li>
  <a href="exec-sum.html">Executive Summary</a>
</li>
<li>
  <a href="chapter1.html">1 - Introduction</a>
</li>
<li>
  <a href="chapter2.html">2 - Overview</a>
</li>
<li>
  <a href="chapter3.html">3 - Lower level tools</a>
</li>
<li>
  <a href="chapter4.html">4 - Designing interactr</a>
</li>
<li>
  <a href="chapter5.html">5 - Discussion</a>
</li>
<li>
  <a href="conclusion.html">Conclusion</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<p><br /></p>
<div id="designing-a-more-flexible-way-of-producing-simple-interactions" class="section level1">
<h1><span class="header-section-number">4</span> Designing a more flexible way of producing simple interactions</h1>
<p>By using gridSVG, DOM and JavaScript, we can customise interactions onto plots. However, these are too specific and assumes a lot of knowledge from the user. We need a way to provide general interactions that can be easily customised and defined by the user without a steep learning curve.</p>
<div id="the-main-idea" class="section level2">
<h2><span class="header-section-number">4.1</span> The main idea</h2>
<p>In each of the previous examples defined, they all have a certain pattern. In order to define a single interaction, it requires the need to know which SVG element to target, what type of interaction or event is to be attached, and how to define what happens when an interaction occurs. This idea can be broken down into 5 simple steps:</p>
<ul>
<li>Draw the plot in R</li>
<li>Identify elements to interact with</li>
<li>Define interactions and process, which elements to target</li>
<li>Attach interactions and define events</li>
<li>Send defined interactions and plot to the browser</li>
</ul>
<p><em>Figure 4.1: Diagram illustrating the basic process of creating interactions</em></p>
<p>To demonstrate this idea, we have created the <code>interactr</code> package which builds upon three main packages: DOM, grid and gridSVG. It is designed to allow users to define their own interactions to plots in R, without a full understanding of the web and these lower level tools.</p>
</div>
<div id="examples" class="section level2">
<h2><span class="header-section-number">4.2</span> Examples</h2>
<div id="linking-box-plots" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Linking box plots</h3>
<p><strong>Note: the following images in this section are static.</strong></p>
<p>The goal in this example is to link the interquartile range of the box plot to a scatter plot, followed by a density plot. When the user clicks on the box plot, it highlights the range of the box plot on the other respective plots.</p>
<p>Our first step is to draw the box plot in R.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(lattice)
bw &lt;-<span class="st"> </span><span class="kw">bwplot</span>(iris<span class="op">$</span>Sepal.Length, <span class="dt">main =</span> <span class="st">&quot;boxplot&quot;</span>)</code></pre></div>
<p>Here, we have stored the boxplot object into a variable called ‘bw’. In order to attach interactions, we need to identify what elements have been drawn. We can do that easily by listing the elements.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">listElements</span>(bw)</code></pre></div>
<p>This will print and return a list of all the elements that make up the box plot in R. Here, the user can identify which element to target and refer to in order to attach interactions.</p>
<p>Next, we can define a simple interaction. We want to achieve an interaction where when the user hovers over the box, it will turn red. In the case of a ‘hover’, we have defined it as a type of interaction to which we can specify the ‘attributes’ and styles of the box (here, we have made it so that it turns red when hovered).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">box &lt;-<span class="st"> &quot;plot_01.bwplot.box.polygon.panel.1.1&quot;</span>
interactions &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">hover =</span> <span class="kw">styleHover</span>(<span class="dt">attrs =</span> <span class="kw">list</span>(<span class="dt">fill =</span> <span class="st">&quot;red&quot;</span>,
                                                     <span class="dt">fill.opacity =</span> <span class="st">&quot;1&quot;</span>)))</code></pre></div>
<p>Note that the interaction has only been defined, but not attached yet. Finally, in order to view our plot in the web browser, we send the plot and our interactions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">draw</span>(bw, box, interactions, <span class="dt">new.page =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>In this step, we have sent the plot we drew in R to a new web page. We can also attach an interaction to the <code>box</code> element we identified earlier to attach the hover interaction to. On the page (Figure 4.2), we see that when the user hovers over the box, the box turns red.</p>
<div class="figure" style="text-align: center">
<img src="fig/int-bp-1.png" alt="Figure 4.2: Boxplot with a hover interaction" width="1016"  />
<p class="caption">
Figure 4.2: Boxplot with a hover interaction
</p>
</div>
<p>Before we move on to drawing the scatter plot, we need to make sure we identify the interquartile range of the box plot and extract any other information we may require from the plot before moving onto the next.</p>
<p>Here, we can return the range of the box plot and store it in a variable called <code>range</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">range &lt;-<span class="st"> </span><span class="kw">returnRange</span>(box)</code></pre></div>
<p>We proceed to add a scatter plot by drawing the scatter plot, listing the elements and identifying the ‘points’, before sending it to the same web page.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sp &lt;-<span class="st"> </span><span class="kw">xyplot</span>(Sepal.Width <span class="op">~</span><span class="st"> </span>Sepal.Length,
             <span class="dt">data =</span> iris,
             <span class="dt">main =</span> <span class="st">&quot;scatterplot&quot;</span>)
<span class="kw">listElements</span>(sp)
points &lt;-<span class="st"> &quot;plot_01.xyplot.points.panel.1.1&quot;</span>
<span class="kw">draw</span>(sp) <span class="co">#by default, new.page = FALSE</span></code></pre></div>
<p>Here, we see that the box plot and the scatter plot we drew in R are now on the same web page (Figure 4.3).</p>
<div class="figure" style="text-align: center">
<img src="fig/int-bp-2.png" alt="Figure 4.3: Box plot and scatter plot on the same web page" width="1014"  />
<p class="caption">
Figure 4.3: Box plot and scatter plot on the same web page
</p>
</div>
<p>To highlight the points in the scatterplot that lie in the range of the box, the user can define the function as follows. We can determine the index of the points that lie within the range of the box, and then pass that index through a function called <code>setPoints</code> to highlight these in red and group them together in a class called <code>selected</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">highlightPoints &lt;-<span class="st"> </span><span class="cf">function</span>(ptr) {
  <span class="co">#identify index</span>
  index &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">min</span>(range) <span class="op">&lt;=</span><span class="st"> </span>iris<span class="op">$</span>Sepal.Length
                 <span class="op">&amp;</span><span class="st"> </span>iris<span class="op">$</span>Sepal.Length <span class="op">&lt;=</span><span class="st"> </span><span class="kw">max</span>(range))
  <span class="co">#identify points and set them to red</span>
  <span class="kw">setPoints</span>(points,
            <span class="dt">type =</span> <span class="st">&quot;index&quot;</span>,
            <span class="dt">value =</span> index,
            <span class="dt">attrs =</span> <span class="kw">list</span>(<span class="dt">fill =</span> <span class="st">&quot;red&quot;</span>,
                         <span class="dt">fill.opacity =</span> <span class="st">&quot;1&quot;</span>,
                         <span class="dt">class =</span> <span class="st">&quot;selected&quot;</span>))
}</code></pre></div>
<p>This function can be easily modified by the user and requires them to make the connection between the data they are dealing with (in this case, the iris data). As we have defined this interaction, we need to define the event to call this interaction to before we can send it to the browser.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boxClick &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">onclick =</span> <span class="st">&#39;highlightPoints&#39;</span>)
<span class="kw">addInteractions</span>(box, boxClick)</code></pre></div>
<p>Here, we insert the function name to run when a ‘click’ is done. Next, we append this defined interaction to the box element, so that when we click on the box, the points in the scatterplot that lie within that range should light up in red. This is shown in Figure 4.4.</p>
<div class="figure" style="text-align: center">
<img src="fig/int-bp-3.png" alt="Figure 4.4: Click on box plot to light up points on scatter plot" width="1027"  />
<p class="caption">
Figure 4.4: Click on box plot to light up points on scatter plot
</p>
</div>
<p>This example can be further extended by linking the box plot to both a scatter plot and density plot. Here, we have taken some census data and wish to find out the density of girls who have the heights that lie within that interquartile range of the boys heights.</p>
<p>We begin by drawing the box plot of boys heights.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#get dataset off web:</span>
census &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;http://new.censusatschool.org.nz/wp-content/uploads/2016/08/CaS2009_subset.csv&quot;</span>,
         <span class="dt">header =</span> <span class="ot">TRUE</span>)

<span class="co">#subset the first 500 values:</span>
census &lt;-<span class="st"> </span>census[<span class="dv">1</span><span class="op">:</span><span class="dv">500</span>, ]

<span class="co"># separate girls and boys:</span>
boys &lt;-<span class="st"> </span>census[census<span class="op">$</span>gender <span class="op">==</span><span class="st"> &quot;male&quot;</span>, ]
girls &lt;-<span class="st"> </span>census[census<span class="op">$</span>gender <span class="op">==</span><span class="st"> &quot;female&quot;</span>, ]

bw &lt;-<span class="st"> </span><span class="kw">bwplot</span>(boys<span class="op">$</span>height, <span class="dt">main =</span> <span class="st">&quot;Boxplot of boys&#39; heights&quot;</span>)
bw.elements &lt;-<span class="st"> </span><span class="kw">listElements</span>(bw, <span class="st">&quot;boys_height&quot;</span>)
box &lt;-<span class="st"> &quot;boys_height.bwplot.box.polygon.panel.1.1&quot;</span>
interactions &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">hover =</span> <span class="kw">styleHover</span>(<span class="dt">attrs =</span> <span class="kw">list</span>(<span class="dt">fill =</span> <span class="st">&quot;red&quot;</span>,
                                                     <span class="dt">fill.opacity =</span> <span class="st">&quot;0.5&quot;</span>,
                                                     <span class="dt">pointer.events =</span> <span class="st">&quot;all&quot;</span>)))
<span class="kw">draw</span>(bw, box, interactions, <span class="dt">new.page =</span> <span class="ot">TRUE</span>)
range &lt;-<span class="st"> </span><span class="kw">returnRange</span>(box)</code></pre></div>
<p>Next, we add the scatterplot to the page.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sp &lt;-<span class="st"> </span><span class="kw">xyplot</span>(boys<span class="op">$</span>armspan <span class="op">~</span><span class="st"> </span>boys<span class="op">$</span>height,
             <span class="dt">main =</span> <span class="st">&quot;Height vs armspan (boys)&quot;</span>,
             <span class="dt">xlab =</span> <span class="st">&quot;Height(cm)&quot;</span>,
             <span class="dt">ylab =</span> <span class="st">&quot;Armspan&quot;</span>)
sp.elements &lt;-<span class="st"> </span><span class="kw">listElements</span>(sp, <span class="st">&quot;sp_bheight&quot;</span>)
points &lt;-<span class="st"> &quot;sp_bheight.xyplot.points.panel.1.1&quot;</span>
<span class="kw">draw</span>(sp)</code></pre></div>
<p>Then, we add the density plot of girls heights.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dplot &lt;-<span class="st"> </span><span class="kw">densityplot</span>(<span class="op">~</span>girls<span class="op">$</span>height,
                     <span class="dt">main=</span><span class="st">&quot;Density plot of girl&#39;s heights&quot;</span>,
                     <span class="dt">xlab=</span><span class="st">&quot;Height(cm)&quot;</span>)
d.elements &lt;-<span class="st"> </span><span class="kw">listElements</span>(dplot, <span class="st">&quot;girls_height&quot;</span>)
dlist &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">points =</span> <span class="st">&quot;girls_height.density.points.panel.1.1&quot;</span>,
              <span class="dt">lines =</span> <span class="st">&quot;girls_height.density.lines.panel.1.1&quot;</span>)
<span class="kw">draw</span>(dplot)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/int-bp-4.png" alt="Figure 4.5: All three plots on the same web page" width="1183"  />
<p class="caption">
Figure 4.5: All three plots on the same web page
</p>
</div>
<p>In order to highlight a certain region of the density plot, we need to add a new element to the page. This can be done using the <code>addPolygon</code> function. Ideally, it should be added to the same group as where the density lines are located. We can use the <code>findPanel</code> function to identify the correct viewport to attach to.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># add invisible polygon to the page:</span>
panel &lt;-<span class="st"> </span><span class="kw">findPanel</span>(dlist<span class="op">$</span>lines)
<span class="kw">addPolygon</span>(<span class="st">&quot;highlightRegion&quot;</span>, panel, <span class="dt">class =</span> <span class="st">&quot;highlight&quot;</span>,
           <span class="dt">attrs =</span> <span class="kw">list</span>(<span class="dt">fill =</span> <span class="st">&quot;red&quot;</span>,
                        <span class="dt">stroke =</span> <span class="st">&quot;red&quot;</span>,
                        <span class="dt">stroke.opacity =</span> <span class="st">&quot;1&quot;</span>,
                        <span class="dt">fill.opacity=</span> <span class="st">&quot;0.5&quot;</span>))</code></pre></div>
<p>This polygon will be invisible to the page as we have not defined the coordinates of the region. We only want this to appear when the user has clicked on the box plot.</p>
<p>Here we write a function that defines what happens after the box plot is clicked. We identify which the coordinates of the density line lie within the range of the box plot. This can be used to define the points of the region that we wish to highlight. We can also highlight the points in the scatter plot in the same way as we have done in the previous example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">highlightRange &lt;-<span class="st"> </span><span class="cf">function</span>(ptr) {

  coords &lt;-<span class="st"> </span><span class="kw">returnRange</span>(dlist<span class="op">$</span>lines)
  index &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">min</span>(range) <span class="op">&lt;=</span><span class="st"> </span>coords<span class="op">$</span>x <span class="op">&amp;</span><span class="st"> </span>coords<span class="op">$</span>x <span class="op">&lt;=</span><span class="st"> </span><span class="kw">max</span>(range))
  xval &lt;-<span class="st"> </span>coords<span class="op">$</span>x[index]
  yval &lt;-<span class="st"> </span>coords<span class="op">$</span>y[index]

  <span class="co"># add start and end:</span>
  xval &lt;-<span class="st"> </span><span class="kw">c</span>(xval[<span class="dv">1</span>], xval, xval[<span class="kw">length</span>(xval)])
  yval &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, yval, <span class="op">-</span><span class="dv">1</span>)

  pt &lt;-<span class="st"> </span><span class="kw">convertXY</span>(xval, yval, panel)

  <span class="co">#set points on added polygon</span>
  <span class="kw">setPoints</span>(<span class="st">&quot;highlightRegion&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;coords&quot;</span>, <span class="dt">value =</span> pt)

  <span class="co"># highlight points in scatter plot:</span>
  index &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">min</span>(range) <span class="op">&lt;=</span><span class="st"> </span>boys<span class="op">$</span>height  
                 <span class="op">&amp;</span><span class="st"> </span>boys<span class="op">$</span>height <span class="op">&lt;=</span><span class="st"> </span><span class="kw">max</span>(range)
                 <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(boys<span class="op">$</span>armspan))
  <span class="co"># note that if armspans are missing,</span>
  <span class="co"># then it will return &#39;element is undefined&#39;,</span>
  <span class="co"># requires !is.na(boys$armspan) to remove missing values</span>
  <span class="kw">setPoints</span>(points,
            <span class="dt">type =</span> <span class="st">&quot;index&quot;</span>,
            <span class="dt">value =</span> index,
            <span class="dt">attrs =</span> <span class="kw">list</span>(<span class="dt">fill =</span> <span class="st">&quot;red&quot;</span>,
                         <span class="dt">fill.opacity =</span> <span class="st">&quot;0.5&quot;</span>,
                         <span class="dt">class =</span> <span class="st">&quot;selected&quot;</span>))

}</code></pre></div>
<p>Finally, we define and attach our interactions to the page.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boxClick &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">onclick =</span> <span class="st">&quot;highlightRange&quot;</span>)
<span class="kw">addInteractions</span>(box, boxClick)</code></pre></div>
<p>When the user now clicks on the box plot, it lights up the points and the density that lie within that range as seen in Figure 4.6.</p>
<div class="figure" style="text-align: center">
<img src="fig/int-bp-5.png" alt="Figure 4.6: A single click on the box plot links the density and scatterplot together" width="1199"  />
<p class="caption">
Figure 4.6: A single click on the box plot links the density and scatterplot together
</p>
</div>
</div>
<div id="changing-a-trendline" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Changing a trendline</h3>
<p>Another example that can be done is driving an off-plot interaction with a slider. The slider controls the smoothing of the trend line.</p>
<p>Here, it becomes more complex as it requires information to be sent and queried in both ways: from R to the browser and from the browser back to R.</p>
<p>Once again, we begin by drawing a plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris.plot &lt;-<span class="st"> </span><span class="kw">xyplot</span>(Petal.Length <span class="op">~</span><span class="st"> </span>Petal.Width,
                    <span class="dt">data =</span> iris,
                    <span class="dt">pch =</span> <span class="dv">19</span>,
                    <span class="dt">type =</span> <span class="kw">c</span>(<span class="st">&quot;p&quot;</span>, <span class="st">&quot;smooth&quot;</span>),
                    <span class="dt">col.line =</span> <span class="st">&quot;orange&quot;</span>, <span class="dt">lwd =</span> <span class="dv">3</span>)
<span class="co">#list elements and print plot</span>
<span class="kw">listElements</span>(iris.plot)
<span class="co">#send plot to browser</span>
<span class="kw">draw</span>(iris.plot, <span class="dt">new.page =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>Next, we add a slider to the page. This has not been linked up to any elements yet.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#add slider to page:</span>
<span class="kw">addSlider</span>(<span class="st">&quot;slider&quot;</span>, <span class="dt">min =</span> <span class="fl">0.5</span>, <span class="dt">max =</span> <span class="dv">1</span>, <span class="dt">step =</span> <span class="fl">0.05</span>)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/int-slider-1.png" alt="Figure 4.7: Plot with slider" width="520"  />
<p class="caption">
Figure 4.7: Plot with slider
</p>
</div>
<p>To define what happens when the slider moves, the user can write a function with the argument <code>value</code>. This passes the value of the slider (as a character) from the web page back to R. Here, we can use the value to control the span of the trend line. To translate the new x and y values of the trend line, we need to convert them into the right scale before updating these points.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">controlTrendline &lt;-<span class="st"> </span><span class="cf">function</span>(value) {
  <span class="kw">showValue</span>(value) <span class="co">#to show value of the slider</span>
  value &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(value)

  <span class="co">#user defines what to do next: (here, recalculates x and y)</span>
  x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(iris<span class="op">$</span>Petal.Width), <span class="kw">max</span>(iris<span class="op">$</span>Petal.Width), <span class="dt">length =</span> <span class="dv">20</span>)
  lo &lt;-<span class="st"> </span><span class="kw">loess</span>(Petal.Length<span class="op">~</span>Petal.Width, <span class="dt">data =</span> iris, <span class="dt">span =</span> value)
  y &lt;-<span class="st"> </span><span class="kw">predict</span>(lo, x)

  <span class="co">#convert coordinates and set points:</span>
  panel &lt;-<span class="st"> </span><span class="kw">findPanel</span>(<span class="st">&#39;plot_01.xyplot.points.panel.1.1&#39;</span>)
  pt &lt;-<span class="st"> </span><span class="kw">convertXY</span>(x, y, panel)
  <span class="kw">setPoints</span>(<span class="st">&quot;plot_01.loess.lines.panel.1.1&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;coords&quot;</span>, <span class="dt">value =</span> pt)
}</code></pre></div>
<p>Once this is done, we need to pass this function to retrieve the value of the slider as it moves. Here, we have a special function called <code>sliderCallback</code> for this. This redefines and creates the entire function that is now called <code>sliderValue</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#pass defined function through sliderCallback to pass slider value correctly</span>
sliderValue &lt;-<span class="st"> </span><span class="kw">sliderCallback</span>(controlTrendline)</code></pre></div>
<p>Finally, we can link this certain interaction back to the slider, such that when the slider moves, the trend line will be updated based upon the value of the slider as seen in Figure 4.8.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">int &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">oninput =</span> <span class="st">&quot;sliderValue&quot;</span>)
<span class="kw">addInteractions</span>(<span class="st">&quot;slider&quot;</span>, int)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/int-slider-2.png" alt="Figure 4.8: Plot with slider that controls the smoothness of the trend line" width="521"  />
<p class="caption">
Figure 4.8: Plot with slider that controls the smoothness of the trend line
</p>
</div>
<p>Another feature that the user may want to achieve is to be able to select a set of points and compute a trend line using those specific points. To be able to do this, we need to add a new element to the page to represent this special trend line. This can be done using the <code>addLine</code> function. Here, we have added it to the same group where these points are.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">panel &lt;-<span class="st"> </span><span class="kw">findPanel</span>(<span class="st">&quot;plot_01.xyplot.points.panel.1.1&quot;</span>)
<span class="kw">addLine</span>(<span class="st">&quot;newSmooth&quot;</span>, panel, <span class="dt">class =</span> <span class="st">&quot;hello&quot;</span>, <span class="kw">list</span>(<span class="dt">stroke =</span> <span class="st">&quot;red&quot;</span>,
                                                  <span class="dt">stroke.width =</span> <span class="st">&quot;1&quot;</span>,
                                                  <span class="dt">fill =</span> <span class="st">&quot;none&quot;</span>))</code></pre></div>
<p>Note that this appears to be hidden on the page, as the points of this line have not been defined yet.</p>
<p>Next, the function needs to be defined to be able to compute this new smoother.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#create new smoother:</span>
createSmooth  =<span class="st"> </span><span class="cf">function</span>(index) {
  <span class="co">#this returns the indices of the points selected</span>
  <span class="co"># could use DOM 0.5 and pass JSON through to avoid this step...</span>
  index &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">strsplit</span>(index, <span class="st">&quot;,&quot;</span>)))
  <span class="co">#filter selected points:</span>
  <span class="cf">if</span> (<span class="kw">length</span>(index) <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span>) {
    selected &lt;-<span class="st"> </span>iris[index, ]
    x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(selected<span class="op">$</span>Petal.Width), <span class="kw">max</span>(selected<span class="op">$</span>Petal.Width), <span class="dt">length =</span> <span class="dv">20</span>)
    lo &lt;&lt;-<span class="st"> </span><span class="kw">loess</span>(Petal.Length <span class="op">~</span>Petal.Width, <span class="dt">data =</span> selected, <span class="dt">span =</span> <span class="dv">1</span>)
    y &lt;-<span class="st"> </span><span class="kw">predict</span>(lo, x)
    <span class="co">#convert co-ordinates:</span>
    pt &lt;-<span class="st"> </span><span class="kw">convertXY</span>(x, y, panel)
  } <span class="cf">else</span> {
    pt &lt;-<span class="st"> &quot;&quot;</span>
  }
  <span class="kw">setPoints</span>(<span class="st">&quot;newSmooth&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;coords&quot;</span>, <span class="dt">value =</span> pt)
}</code></pre></div>
<p>Because the index of the points need to be returned from the browser back to R, we use <code>boxCallback</code> to help us link these functions together. As linking a selection box is a special kind of interaction, we can pass our defined function through to the <code>addSelectionBox</code> function which adds on the selection box and links the defined interactions together to compute the new smoother.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#link callback functions together to pass index values to function</span>
boxIndex =<span class="st"> </span><span class="kw">boxCallback</span>(createSmooth)
<span class="kw">addSelectionBox</span>(<span class="dt">plotNum =</span> <span class="dv">1</span>, <span class="dt">el =</span> <span class="st">&quot;plot_01.xyplot.points.panel.1.1&quot;</span>, <span class="dt">f =</span> <span class="st">&quot;boxIndex&quot;</span>)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/int-slider-3.png" alt="Figure 4.9: Plot that has a selection box feature that draws a separate smoother" width="522"  />
<p class="caption">
Figure 4.9: Plot that has a selection box feature that draws a separate smoother
</p>
</div>
<p>On the page, the user now can draw a selection box over a set of points, and a new smoother should render on the page based upon these points. The notion of having special functions are required when there is a need for querying the browser for more information (such as the value of the slider, or the points selected on a page). In our previous example, that information was stored back in R which did not require a special callback function. These types of interactions are more complex to handle.</p>
</div>
</div>
<div id="compatibility-with-other-graphics-systems" class="section level2">
<h2><span class="header-section-number">4.3</span> Compatibility with other graphics systems</h2>
<p>A possibility of extending this idea further is the compability with other R graphing systems including <strong>lattice</strong>, <strong>graphics</strong>, and <strong>ggplot2</strong>. As we have seen above, many of these examples are done with <strong>lattice</strong> plots. However, it is possible to achieve the same with different graphing systems. To demonstrate, we have taken the box plot example in Figure 4.2 and replicated it in graphics and ggplot2.</p>
<div id="graphics-plots" class="section level3">
<h3><span class="header-section-number">4.3.1</span> graphics plots</h3>
<p>As briefly mentioned in Chapter 3, in order to convert SVG objects using gridSVG the objects must be grid objects. In the case of graphics plots, we cannot directly call gridSVG to convert it into an SVG. A simple solution to this is to use the <strong>gridGraphics</strong> package, which acts as a translator by converting graphics plots into grid plots with a consistent naming scheme. The <code>grid.echo()</code> function achieves this.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(grid)
<span class="kw">plot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)
<span class="kw">grid.ls</span>()
gridGraphics<span class="op">::</span><span class="kw">grid.echo</span>()
<span class="kw">grid.ls</span>()</code></pre></div>
<p><img src="chapter4_files/figure-html/unnamed-chunk-32-1.png" width="672"  style="display: block; margin: auto;" /> <img src="chapter4_files/figure-html/unnamed-chunk-32-2.png" width="672"  style="display: block; margin: auto;" /></p>
<pre><code>## graphics-background
## graphics-plot-1-points-1
## graphics-plot-1-bottom-axis-line-1
## graphics-plot-1-bottom-axis-ticks-1
## graphics-plot-1-bottom-axis-labels-1
## graphics-plot-1-left-axis-line-1
## graphics-plot-1-left-axis-ticks-1
## graphics-plot-1-left-axis-labels-1
## graphics-plot-1-box-1
## graphics-plot-1-xlab-1
## graphics-plot-1-ylab-1</code></pre>
<p>Figure 4.10: An example of a graphics plot that is converted into a grid plot using gridGraphics</p>
<p>The code above produces a graphics plot that has been converted to a grid plot (as seen in Figure 4.10). To check this, we have called <code>grid.ls()</code> to check whether is a grid object. In the first call, it returns nothing because it is not a grid object. Once we call <code>grid.echo()</code>, <code>grid.ls()</code> returns a list of elements that make up the plot.</p>
<p>Another problem is that when we plot or try save it into a variable, it does not plot to the graphics device. To solve this, we can use <code>recordPlot</code> to record the plot that has been drawn to further process it.</p>
<p>The only change that we need to do is run an extra <code>recordPlot</code> command before we call <code>listElements</code>.</p>
<p>Once again, we begin by drawing the plot. We then record the plot before listing its elements. This will automatically convert the plot using <code>grid.echo()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(iris<span class="op">$</span>Sepal.Length, <span class="dt">horizontal =</span> <span class="ot">TRUE</span>)
pl &lt;-<span class="st"> </span><span class="kw">recordPlot</span>()
<span class="kw">listElements</span>(pl)</code></pre></div>
<p>Next, the same process occurs. We see that the code is very similar to what was done previously with <code>lattice</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">box =<span class="st"> &quot;graphics-plot-1-polygon-1&quot;</span>
interactions &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">hover =</span> <span class="kw">styleHover</span>(<span class="dt">attrs =</span> <span class="kw">list</span>(<span class="dt">fill =</span> <span class="st">&quot;red&quot;</span>,
                                                     <span class="dt">fill.opacity =</span> <span class="st">&quot;1&quot;</span>)))
<span class="kw">draw</span>(pl, box, interactions, <span class="dt">new.page =</span> <span class="ot">TRUE</span>)
range &lt;-<span class="st"> </span><span class="kw">returnRange</span>(box)

<span class="co"># plot a graphics scatter plot</span>
<span class="kw">plot</span>(iris<span class="op">$</span>Sepal.Length, iris<span class="op">$</span>Sepal.Width)
sp &lt;-<span class="st"> </span><span class="kw">recordPlot</span>()
<span class="kw">listElements</span>(sp)
<span class="kw">draw</span>(sp)

<span class="co">#add interactions</span>
points &lt;-<span class="st"> &#39;graphics-plot-1-points-1&#39;</span>
highlightPoints &lt;-<span class="st"> </span><span class="cf">function</span>(ptr) {
  <span class="co">#find the index of points that lie within the range of the box</span>
  index &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">min</span>(range) <span class="op">&lt;=</span><span class="st"> </span>iris<span class="op">$</span>Sepal.Length
                 <span class="op">&amp;</span><span class="st"> </span>iris<span class="op">$</span>Sepal.Length <span class="op">&lt;=</span><span class="st"> </span><span class="kw">max</span>(range))
  <span class="kw">setPoints</span>(points,
            <span class="dt">type =</span> <span class="st">&quot;index&quot;</span>,
            <span class="dt">value =</span> index,
            <span class="dt">attrs =</span> <span class="kw">list</span>(<span class="dt">fill =</span> <span class="st">&quot;red&quot;</span>,
                         <span class="dt">fill.opacity =</span> <span class="st">&quot;1&quot;</span>,
                         <span class="dt">class =</span> <span class="st">&quot;selected&quot;</span>))
}

boxClick &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">onclick =</span> <span class="st">&quot;highlightPoints&quot;</span>)
<span class="kw">addInteractions</span>(box, boxClick)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/int-bp-graphics.png" alt="Figure 4.11: box plot example replicated using a graphics plot" width="799"  />
<p class="caption">
Figure 4.11: box plot example replicated using a graphics plot
</p>
</div>
<p>This shows that there is potential for customising interactions onto graphics plots. The process is the same, except due to the nature of the graphics plot not being a ‘grid’ plot.</p>
</div>
<div id="ggplot2" class="section level3">
<h3><span class="header-section-number">4.3.2</span> ggplot2</h3>
<p><strong>ggplot2</strong> (Wickham et al, 2017) is a popular plotting system in R based upon the “Grammar of Graphics”. It is built upon the <code>grid</code> graphics system, which makes it compatible with gridSVG.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> iris, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> Sepal.Length)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()
p.elements &lt;-<span class="st"> </span><span class="kw">listElements</span>(p)
box &lt;-<span class="st"> </span><span class="kw">findElement</span>(<span class="st">&quot;geom_polygon.polygon&quot;</span>)
interactions &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">hover =</span> <span class="kw">styleHover</span>(<span class="dt">attrs =</span> <span class="kw">list</span>(<span class="dt">fill =</span> <span class="st">&quot;red&quot;</span>,
                                                     <span class="dt">fill.opacity =</span> <span class="st">&quot;1&quot;</span>,
                                                     <span class="dt">pointer.events =</span> <span class="st">&quot;all&quot;</span>)))
<span class="kw">draw</span>(p, box, interactions, <span class="dt">new.page =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>However, because it works on a completely different co-ordinates system, we cannot simply use the <code>returnRange</code> function to define the range of the box.</p>
<p>The native coordinates given by <code>grid</code> do not return that data coordinates of the ggplot. A simple solution to this is that the information about the plot can be extracted from <code>ggplot_build</code>. Below, we have identified the range of the box manually.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#find the range of the box:</span>
boxData &lt;-<span class="st"> </span><span class="kw">ggplot_build</span>(p)<span class="op">$</span>data[[<span class="dv">1</span>]]
<span class="co">#for a box plot - IQR: lower, upper</span>
range &lt;-<span class="st"> </span><span class="kw">c</span>(boxData<span class="op">$</span>lower, boxData<span class="op">$</span>upper)</code></pre></div>
<p>Next, we add the scatterplot to the page, define our interactions before sending it to the browser.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> iris, <span class="kw">aes</span>(<span class="dt">x =</span> Sepal.Width, <span class="dt">y =</span>Sepal.Length)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()
sp.elements &lt;-<span class="st"> </span><span class="kw">listElements</span>(sp)
<span class="kw">draw</span>(sp)
points &lt;-<span class="st"> </span><span class="kw">findElement</span>(<span class="st">&quot;geom_point.point&quot;</span>)

highlightPoints &lt;-<span class="st"> </span><span class="cf">function</span>(ptr) {
  <span class="co">#find the index of points that lie within the range of the box</span>
  index &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">min</span>(range) <span class="op">&lt;=</span><span class="st"> </span>iris<span class="op">$</span>Sepal.Length
                 <span class="op">&amp;</span><span class="st"> </span>iris<span class="op">$</span>Sepal.Length <span class="op">&lt;=</span><span class="st"> </span><span class="kw">max</span>(range))
  <span class="kw">setPoints</span>(points,
            <span class="dt">type =</span> <span class="st">&quot;index&quot;</span>,
            <span class="dt">value =</span> index,
            <span class="dt">attrs =</span> <span class="kw">list</span>(<span class="dt">fill =</span> <span class="st">&quot;red&quot;</span>,
                         <span class="dt">fill.opacity =</span> <span class="st">&quot;1&quot;</span>,
                         <span class="dt">class =</span> <span class="st">&quot;selected&quot;</span>))
}

boxClick &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">onclick =</span> <span class="st">&quot;highlightPoints&quot;</span>)
<span class="kw">addInteractions</span>(box, boxClick)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/int-bp-ggplot2.png" alt="Figure 4.11: box plot example replicated using ggplot2" width="811"  />
<p class="caption">
Figure 4.11: box plot example replicated using ggplot2
</p>
</div>
<p>Note that the only difference are the tags for how each element is defined. Because ggplot2 does not have a consistent naming scheme like <strong>lattice</strong> we can use the <code>findElement</code> function to allow the user to easily find which element they want to refer to.</p>
<p>This demonstrates that there is a possible way of achieving interactions with ggplot2 and there is potential for the <strong>interactr</strong> to plug into different R plotting systems. Consequently it also means that when we assess the compatibility of different plotting systems, we need to take into account of possible detours that could occur. Because this is a simplistic example, it may become more complex when we try to achieve more sophisticated interactions.</p>
<p>The <strong>interactr</strong> package acts as a proof-of-concept that aims to be a general solution for adding simple interactions to plots generated in R. There is potential in plugging into different plotting systems, however it depends on how compatible these systems are with the underlying tools of the <strong>interactr</strong> package. It is based upon a very simple process of defining what you want to draw in R, identifying elements drawn, and defining specific interactions to attach to certain elements drawn that can be viewed in a web browser.</p>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
